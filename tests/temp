接收到用户消息：
# 流程执行步骤
## 步骤1：并行执行下述节点
节点1：调用大模型判断是否需要转人工
节点2：调用大模型进行情感分析
节点3：调用大模型生成闲聊回复语

## 步骤2：转人工判断
分支1：转人工判断为是，执行步骤 
分支2：转人工判断为否，进入步骤3

## 步骤3：情感判断
分支1：情感得分为3，执行步骤
分支2：情感得分为2，执行步骤
分支3：情感得分为0、1，执行步骤

## 步骤4：沟通意愿判断
分支1：负向，执行步骤
分支2：正向，执行步骤5

## 步骤5：xx



# 执行节点
## N1：候选人是否申请转人工
prompt：transfer_human_intent
input信息：候选人最后一句话

## N2：候选人情感分析
prompt: candidate_emotion
input信息：最后几轮对话

## N3：候选人是否愿意沟通
prompt：continue_conversation_with_candidate
input信息：对话信息

## N4：候选人是否发问
prompt：candidate_ask_question
input信息：候选人最后一条消息、对话信息

## N5: 基于知识库回复求职者
prompt: answer_based_on_knowledge
input信息：
岗位信息、知识库信息、对话信息、候选人最后发言
注：知识库是根据候选人最后发言从知识库中召回

## N6：无知识库时兜底回复
prompt: answer_without_knowledge
input信息：对话信息、候选人最后发言、候选人问题类别

## N7: 陪候选人闲聊
prompt：casual_conversation
input信息：对话信息、职位信息、HR（AI）最后一句话

## N8：高情商回复（结束语）
prompt: high_eq_response
input信息：对话信息、职位信息、HR（AI）最后一句话、招聘方要了解的问题清单

## N9：复聊语
prompt: resume_conversation
input信息：职位名称、对话信息

## N10：候选人回复和问题相关性
prompt：relevance_reply_and_question
input信息：HR（AI）设定当前正在沟通的问题、候选人当前的回复信息

## N11: 候选人的回复是否满足设定的要求
prompt: reply_match_question_requirement
input信息：HR（AI）设定当前正在沟通的问题、对话信息

## N12: 候选人针对问题的沟通意愿
prompt：candidate_communication_willingness_for_question
input信息：对话信息


# 约定执行节点响应
action: 下一步的动作 
NONE(不做任何处理)、SUSPEND（中断流程执行）、TERMINATE（终止会话）、NEXT_NODE(执行下一个节点)、SEND_MESSAGE(发送返回的消息)
context: 下一步动作的上下文, action为NONE、SUSPEND、TERMINATE时为None; NEXT_NODE时为下一个节点名称；SEND_MESSAGE时为要发送的消息内容


# 执行节点
## 节点说明
状态判断（分支选择）节点：branch routing node，简称BRN，进行当前上线文判断，根据执行结果决定执行分支或动作
状态转移（动作执行）节点：action execute node, 简称ACN，执行具体的业务行为，这里主要是确定要发送给后续人的内容及状态转移
混合节点：combine node，简称CN，分支选择和状态转移耦合在一起

## 状态判断（分支选择）节点
### BRN1：候选人是否申请转人工
场景名：transfer_human_intent
模板变量：候选人最后一条消息
执行逻辑：CLG1 
模型响应结果：{"transfer": "no"}
节点返回结果：执行结果为是，action为SUSPEND；否则为NEXT_NODE，context为BRN2的节点名称

### BRN2：候选人情感分析
场景名: candidate_emotion
模板变量：历史对话
执行逻辑：CLG1
模型响应结果：{
    "分数": "",
    "原因": ""
}
节点返回结果：分所为是，action为SUSPEND；否则为NEXT_NODE，context为BRN2的节点名称

### BRN3：候选人是否愿意沟通
前置条件：不是Stage2并且不是Stage3
场景名：continue_conversation_with_candidate
模板变量：历史对话
执行逻辑：CLG1


### BRN4：候选人是否发问
场景名：candidate_ask_question
模板变量：候选人最后一条消息、历史对话
执行逻辑：CLG1


### BRN5：候选人回复和问题相关性
前置条件：Stage2并且当前询问问题是判卷问题
场景名：relevance_reply_and_question
模板变量：HR（AI）设定当前正在沟通的问题、候选人最后一条消息
执行逻辑：CLG1


### BRN6: 候选人的回复是否满足设定的要求
场景名: reply_match_question_requirement
模板变量：HR（AI）设定当前正在沟通的问题、历史对话
执行逻辑：CLG1

### BRN7: 候选人针对问题的沟通意愿
前置条件：Stage2并且当前询问问题不是判卷问题
场景名：candidate_communication_willingness_for_question
模板变量：历史对话
执行逻辑：CLG1

### BRN8: 候选人对职位是否有意向
前置条件：Stage3
场景名：candidate_position_willingness
模板变量：历史对话
执行逻辑：CLG1


## 混合节点
## CN1: 基于知识库回复求职者
场景名: answer_based_on_knowledge
模板变量：职位信息、知识库信息、历史对话、候选人最后一条消息
执行逻辑：额外查询职位对应的知识库信息，和入参中上下文中已存在的其他模板变量，继续执行CLG1


## 状态转移（动作执行）节点
### ACN1：无知识库时兜底回复
场景名: answer_without_knowledge
模板变量：历史对话、候选人最后一条消息
执行逻辑：CLG1

### ACN2: 陪候选人闲聊
场景名：casual_conversation
模板变量：历史对话、职位信息、HR（AI）最后一句话
执行逻辑：CLG1

### ACN3：高情商回复（结束语）
场景名: high_eq_response
模板变量：历史对话、职位信息、HR（AI）最后一句话、招聘方设置的当前职位的问题列表
执行逻辑：CLG1

### ACN4：复聊语
场景名: resume_conversation
模板变量：职位名称、历史对话
执行逻辑：CLG1


# 通用执行逻辑
执行逻辑是指节点中的具体代码逻辑
## CLG1
1.根据场景名从prompt_config中读取对应的配置
2.根据prompt配置从对应的prompt模板文件中读取prompt模板
3.替换prompt模板中的变量
5.根据对应的配置调用大模型进行执行
备注：可以封装为通用函数，执行类型java中StringSubstitutorParam；StringSubstitutorUtils.replace(promptMasterConfigBO.getPromptTemplate(), promptParams);

# 会话状态
## 会话状态
State1: 会话开启
State2: 沟通中
State3: 中断
State4: 会话结束

## 会话流程执行阶段
Stage1：场白阶段（HR主动打招呼，或者候选人主动打招呼）
Stage2：问题询问阶段（HR（AI）正在就一下问题询问候选人）
Stage3：职位意向询问阶段
Stage4：撮合模板完成



# 业务执行流程
触发时机：候选人发送一条消息
执行流程：
step1: 并行调用节点BRN1、BRN2，同时下述条件判断并行执行对应的意愿判断节点：
IF Stage2 THEN BRN7 ELSEIF Stage3 THEN BRN8 ELSE BRN3

step2: 
IF BRN1=YES 中断本次流程执行
IF BRN2 = 3 THEN 中断本次流程执行
ELSE IF BRN2 = 3 THEN ACN3
ELSE 





